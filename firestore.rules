rules_version = '2';
// Firestore security rules for AIra. Schema: profiles, teaching_sessions, doubts, notes, flashcards, mind_maps (all with user_id / userId).
// The rate_limits collection is used only by Cloud Functions (Admin SDK); no client access â€” leave unmatched so it is denied for clients.
service cloud.firestore {
  match /databases/{database}/documents {
    match /profiles/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    match /teaching_sessions/{sessionId} {
      allow read, write: if request.auth != null && resource.data.user_id == request.auth.uid;
      allow create: if request.auth != null && request.resource.data.user_id == request.auth.uid;
    }
    match /doubts/{doubtId} {
      allow read, write: if request.auth != null && resource.data.user_id == request.auth.uid;
      allow create: if request.auth != null && request.resource.data.user_id == request.auth.uid;
    }
    match /notes/{noteId} {
      allow read, write: if request.auth != null && resource.data.user_id == request.auth.uid;
      allow create: if request.auth != null && request.resource.data.user_id == request.auth.uid;
    }
    match /flashcards/{cardId} {
      allow read, write: if request.auth != null && resource.data.user_id == request.auth.uid;
      allow create: if request.auth != null && request.resource.data.user_id == request.auth.uid;
    }
    match /mind_maps/{mapId} {
      allow read, write: if request.auth != null && resource.data.user_id == request.auth.uid;
      allow create: if request.auth != null && request.resource.data.user_id == request.auth.uid;
    }
    // Server-only: rate_limits used by Cloud Functions (Admin SDK). Explicit deny for clients.
    match /rate_limits/{document=**} {
      allow read, write: if false;
    }
  }
}
